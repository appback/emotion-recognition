<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="description" content="" />
		<meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors" />
		<meta name="generator" content="Hugo 0.80.0" />
		<title>얼굴인식</title>
		<link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/album/" />
		<link href="assets/dist/css/bootstrap.min.css" rel="stylesheet" />
	</head>

	<style>
		.bd-placeholder-img {
			font-size: 1.125rem;
			text-anchor: middle;
			-webkit-user-select: none;
			-moz-user-select: none;
			user-select: none;
		}

		@media (min-width: 768px) {
			.bd-placeholder-img-lg {
				font-size: 3.5rem;
			}
		}
	</style>
	<!--script async src="./opencv.js"></script-->
	<main>
		<section class="py-5 text-center container">
			<div class="row py-lg-5">
				<div class="col-lg-6 col-md-8 mx-auto">
					<h1 class="fw-light">Opencv.js 안면 인식</h1>
					<p class="lead text-muted" id="status">OpenCV.js is loading...</p>
					<div class="spinner-border text-primary" role="status" id="loader">
						<span class="sr-only"></span>
					</div>
				</div>
			</div>
		</section>

		<div class="album py-5 bg-light">
			<div class="container">
				<div
					class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-md-4 g-3 text-center"
				>
					<div class="col">
						<div class="card shadow-sm">
							<img id="imageSrc" src="" />
							<div class="card-body"></div>
						</div>
					</div>

					<div class="col">
						<div class="card shadow-sm">
							<canvas id="grayImg"></canvas>
							<div class="card-body"></div>
						</div>
					</div>

					<div class="col">
						<div class="card shadow-sm">
							<canvas id="facedetectedImg"></canvas>
							<div class="card-body"></div>
						</div>
					</div>

					<div class="col">
						<div class="card shadow-sm">
							<canvas id="croppedImg"></canvas>
							<div class="card-body"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>

	<script src="assets/dist/js/bootstrap.bundle.min.js"></script>
	<script type="text/javascript">
		// let width, height;

		// const constraints = {
		// 	video: { facingMode: 'user' },
		// 	audio: false,
		// };
		// const video = document.getElementById('video');
		// const canvas = document.getElementById('output');
		// canvas.width = width;
		// canvas.height = height;

		// function successCallback(stream) {
		// 	video.width = width;
		// 	video.height = height; //prevent Opencv.js error.
		// 	video.srcObject = stream;
		// 	video.play();
		// }

		// function errorCallback(error) {
		// 	console.log(error);
		// }

		// let streaming = false;
		// function toggleStream() {
		// 	if (streaming === false) {
		// 		navigator.getUserMedia(constraints, successCallback, errorCallback);
		// 		document.getElementById('toggleStream').innerHTML = 'Stop';
		// 		document.getElementById('cvtGray').style.visibility = 'visible';
		// 	} else {
		// 		const stream = video.srcObject;
		// 		const tracks = stream.getTracks();
		// 		tracks.forEach((track) => {
		// 			track.stop();
		// 		});
		// 		document.getElementById('toggleStream').innerHTML = 'Play';
		// 		document.getElementById('cvtGray').style.visibility = 'hidden';
		// 	}
		// 	streaming = !streaming;
		// }


		// function process() {
		// 	if (streaming === true) {
		// 		cap.read(src);
		// 		cv.cvtColor(src, dst, cv.COLOR_RGBA2GRAY);

		// 		cv.imshow('output', dst);
		// 		setTimeout(process, 33);
		// 	}
		// }

		// let imgElement = document.getElementById('imageSrc');
		// let inputElement = document.getElementById('fileInput');

		// inputElement.addEventListener(
		// 	'change',
		// 	(e) => {
		// 		imgElement.src = URL.createObjectURL(e.target.files[0]);
		// 	},
		// 	false
		// );

		// imgElement.onload = function () {
		// 	let mat = cv.imread(imgElement);
		// 	let gray = new cv.Mat();
		// 	cv.cvtColor(mat, gray, cv.COLOR_RGB2GRAY, 0);
		// 	cv.imshow('grayImg', gray);

		// 	try {
		// 		classifier.detectMultiScale(gray, faces, 1.1, 3, 0);
		// 		console.log(faces.size());
		// 	} catch (err) {
		// 		console.log('Error: ' + err);
		// 	}
		// 	for (let i = 0; i < faces.size(); ++i) {
		// 		let face = faces.get(i);
		// 		cv.imshow('croppedImg', mat.roi(face));
		// 		let point1 = new cv.Point(face.x, face.y);
		// 		let point2 = new cv.Point(face.x + face.width, face.y + face.height);
		// 		cv.rectangle(mat, point1, point2, [255, 0, 0, 255]);
		// 	}
		// 	cv.imshow('facedetectedImg', mat);
		// 	mat.delete();
		// };

		let faces;
		let classifier;
		let utils;

		function onOpenCvReady() {
			cv['onRuntimeInitialized'] = () => {
				faces = new cv.RectVector();
				classifier = new cv.CascadeClassifier();
				utils = new Utils('errorMessage');
				let faceCascadeFile = 'haarcascade_frontalface_default.xml'; // path to xml
				utils.createFileFromUrl(faceCascadeFile, faceCascadeFile, () => {
					classifier.load(faceCascadeFile); // in the callback, load the cascade from file
					document.getElementById('status').innerHTML =
						'데이터 로딩이 완료되었습니다. 이제 변환할 사진을 업로드 하세요.';
					// document.getElementById('loader').style.display = 'none';
					// document.getElementById('imageSrc').src = 'face.jpg';
				});
			};
		}
	</script>
	<script src="js/utils.js"></script>
	<script async src="js/opencv.js" onload="onOpenCvReady();" type="text/javascript"></script>
</html>